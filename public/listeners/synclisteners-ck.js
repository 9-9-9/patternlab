/*!
 * Sync Listeners, v0.1
 *
 * Copyright (c) 2013 Dave Olsen, http://dmolsen.com
 * Licensed under the MIT license
 *
 * The JavaScript component of the WebSocket set-up that supports syncing
 * navigation between browsers and content updates with the server.
 *
 * The WebSocket test is from Modernizr. It might be a little too strict for our purposes.
 * https://github.com/Modernizr/Modernizr/blob/master/feature-detects/websockets.js
 *
 */function connectNavSync(){if("WebSocket"in window&&window.WebSocket.CLOSING===2){var e="Page Follow";wsn=new WebSocket("ws://"+host+":"+navSyncPort+"/navsync");wsn.onopen=function(t){wsnConnected=!0;$("#navSyncButton").attr("data-state","on");$("#navSyncButton").addClass("connected");$("#navSyncButton").html(e+" On")};wsn.onclose=function(t){wsnConnected=!1;$("#navSyncButton").attr("data-state","off");$("#navSyncButton").hasClass("connected")&&$("#navSyncButton").removeClass("connected");$("#navSyncButton").html(e+" Disabled")};wsn.onmessage=function(e){var t=document.getElementById("sg-viewport").contentWindow.location.href,n="http://"+window.location.host+e.data;t!=n&&$sgViewport.attr("src",n)};wsn.onerror=function(t){wsnConnected=!1;$("#navSyncButton").attr("data-state","off");$("#navSyncButton").hasClass("connected")&&$("#navSyncButton").removeClass("connected");$("#navSyncButton").html(e+" Disabled")}}}function connectContentSync(){if("WebSocket"in window&&window.WebSocket.CLOSING===2){var e=!0,t="Auto-reload";wsc=new WebSocket("ws://"+host+":"+contentSyncPort+"/contentsync");wsc.onopen=function(e){wscConnected=!0;$("#contentSyncButton").attr("data-state","on");$("#contentSyncButton").addClass("connected");$("#contentSyncButton").html(t+" On")};wsc.onclose=function(e){wscConnected=!1;$("#contentSyncButton").attr("data-state","off");$("#contentSyncButton").hasClass("connected")&&$("#contentSyncButton").removeClass("connected");$("#contentSyncButton").html(t+" Disabled")};wsc.onmessage=function(e){$sgViewport.attr("src",$sgViewport.attr("src")+"?"+e.data)};wsc.onerror=function(e){wscConnected=!1;$("#contentSyncButton").attr("data-state","off");$("#contentSyncButton").hasClass("connected")&&$("#contentSyncButton").removeClass("connected");$("#contentSyncButton").html(t+" Disabled")}}}var wsn,wsnConnected=!1,wsc,wscConnected=!1,dataPrevious=0,host=window.location.host;connectNavSync();connectContentSync();$("#navSyncButton").click(function(){if($(this).attr("data-state")=="on"){wsn.close();$(this).attr("data-state","off");$(this).removeClass("connected");$(this).html("Nav Sync Off")}else{connectNavSync();$(this).attr("data-state","on");$(this).addClass("connected");$(this).html("Nav Sync On")}});$("#contentSyncButton").click(function(){if($(this).attr("data-state")=="on"){wsc.close();$(this).attr("data-state","off");$(this).removeClass("connected");$(this).html("Content Sync Off")}else{connectContentSync();$(this).attr("data-state","on");$(this).addClass("connected");$(this).html("Content Sync On")}});